<!DOCTYPE html><html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>æˆèªç¤¦å ´ Â· MVP</title>
<style>
  :root{
    --bg:#0f172a; /* slate-900 */
    --card:#111827; /* gray-900 */
    --muted:#94a3b8; /* slate-400 */
    --text:#e5e7eb; /* gray-200 */
    --brand:#22c55e; /* green-500 */
    --brand-2:#38bdf8; /* sky-400 */
    --warn:#f59e0b; /* amber-500 */
    --danger:#ef4444; /* red-500 */
    --ok:#10b981; /* emerald-500 */
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color: transparent;}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b1222,#0f172a 40%,#0b1222);color:var(--text);font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans CJK TC", "PingFang TC", "Microsoft JhengHei", "Heiti TC", Arial, sans-serif;}
  .app{max-width:1100px;margin:0 auto;padding:16px;}
  header{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
  .title{font-weight:800;font-size:22px;letter-spacing:1px;}
  .pill{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.06);padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.08)}
  .btn{background:linear-gradient(180deg,#1e293b,#0f172a);border:1px solid rgba(255,255,255,.12);color:#fff;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;user-select:none;touch-action:manipulation}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn.primary{background:linear-gradient(180deg,#16a34a,#15803d);border-color:#166534}
  .btn.brand{background:linear-gradient(180deg,#38bdf8,#0284c7);border-color:#0369a1}
  .btn.warn{background:linear-gradient(180deg,#f59e0b,#b45309);border-color:#92400e}
  .btn.ghost{background:transparent;border:1px dashed rgba(255,255,255,.2)}
  .spacer{flex:1}
  .grid{display:grid;gap:12px}
  .cards{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:12px}
  .card{grid-column:span 12;background:linear-gradient(180deg,#0b1222,#0f172a);border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:14px}
  @media (min-width:800px){
    .card.span4{grid-column:span 4}
    .card.span6{grid-column:span 6}
    .card.span8{grid-column:span 8}
  }
  .card h2{margin:4px 0 10px;font-size:18px}
  .stat{display:flex;align-items:center;gap:10px;font-weight:700}
  .token{display:inline-flex;align-items:center;gap:6px;padding:2px 10px;border-radius:999px;background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.35)}
  .muted{color:var(--muted)}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .tab{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);cursor:pointer;background:rgba(255,255,255,.04)}
  .tab.active{background:linear-gradient(180deg,#38bdf8,#0284c7);border-color:#0284c7}
  .section{display:none}
  .section.active{display:block}
  .flex{display:flex;gap:12px;flex-wrap:wrap}
  .inv{display:flex;flex-wrap:wrap;gap:8px;min-height:46px;padding:8px;border:1px dashed rgba(255,255,255,.18);border-radius:12px;background:rgba(255,255,255,.03)}
  .tile{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#111827,#0b1222);border:1px solid rgba(255,255,255,.15);font-size:22px;font-weight:800;cursor:pointer;user-select:none}
  .tile.sel{outline:2px solid var(--brand-2);}
  .tile.wild{background:linear-gradient(180deg,#065f46,#064e3b);border-color:#047857}
  .tile.ghost{opacity:.35}
  .slots{display:flex;gap:8px;align-items:center}
  .slot{width:52px;height:52px;border-radius:12px;border:2px dashed rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:800;background:rgba(255,255,255,.03)}
  .slot.filled{border-style:solid;background:rgba(56,189,248,.08)}
  .wall{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  .brick{min-height:52px;border-radius:12px;padding:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#1f2937,#0f172a);border:1px solid rgba(255,255,255,.12);font-weight:800}
  .shop{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
  @media (max-width:640px){.shop{grid-template-columns:repeat(3,1fr)}}
  .shopItem{display:flex;flex-direction:column;align-items:center;gap:6px;padding:8px;border-radius:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.12)}
  .hint{font-size:12px;color:var(--muted)}
  .kbd{display:inline-block;padding:2px 6px;border-radius:6px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.06);font-size:12px}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;background:rgba(2,6,23,.9);color:#e2e8f0;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.14);box-shadow:0 8px 20px rgba(0,0,0,.4);z-index:999}
  .row{display:flex;align-items:center;gap:10px}
  .divider{height:1px;background:rgba(255,255,255,.12);margin:10px 0}
  .right{margin-left:auto}
  .tag{border:1px solid rgba(255,255,255,.2);border-radius:999px;padding:2px 8px;font-size:12px;color:var(--muted)}
  .danger{color:#fecaca}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="title">ğŸ—ï¸ æˆèªç¤¦å ´ Â· MVP</div>
    <span class="pill" id="tokenPill">ğŸ’° ä»£å¹£ <b id="tokenCount">0</b></span>
    <span class="pill" id="streakPill">ğŸ”¥ é€£çºŒç°½åˆ° <b id="streak">0</b> å¤©</span>
    <button class="btn primary" id="signinBtn">ç°½åˆ°</button>
    <button class="btn brand" id="saveBtn" title="å°‡é€²åº¦ä¿å­˜åˆ°ç€è¦½å™¨ï¼ˆè‡ªå‹•ï¼‰">ä¿å­˜</button>
    <button class="btn ghost" id="exportBtn">åŒ¯å‡ºå­˜æª”</button>
    <button class="btn ghost" id="importBtn">åŒ¯å…¥</button>
    <div class="spacer"></div>
    <button class="btn warn" id="resetBtn">é‡ç½®</button>
  </header>  <div class="tabs" id="tabs">
    <div class="tab active" data-tab="mine">â›ï¸ ç¤¦å ´</div>
    <div class="tab" data-tab="build">ğŸ—ï¸ å·¥åœ°</div>
    <div class="tab" data-tab="market">ğŸª å¸‚é›†</div>
    <div class="tab" data-tab="dict">ğŸ“š æˆèªåº«</div>
    <div class="tab" data-tab="help">â” æ•™å¸«/èªªæ˜</div>
  </div>  <!-- ç¤¦å ´ -->  <section class="section active" id="sec-mine">
    <div class="cards">
      <div class="card span8">
        <h2>â›ï¸ æŒ–æ˜å­—å¡Š</h2>
        <div class="row">
          <button class="btn brand" id="digBtn">æŒ– ç¤¦ï¼ˆç²å¾— 1 å­—å¡Š + 1~3 ä»£å¹£ï¼‰</button>
          <span class="hint">æ¯æ¬¡æŒ–ç¤¦éƒ½æœ‰æ©Ÿæœƒç²å¾—å¯¶ç®±ï¼ˆé¡å¤–ä»£å¹£ï¼‰ã€‚</span>
        </div>
        <div class="divider"></div>
        <div class="stat">ğŸ§± æœ€æ–°æŒ–å‡ºï¼š<span id="lastTile" class="tile ghost">ï¼Ÿ</span><span class="hint">é»æ“Šå­—å¡Šå¯ç›´æ¥åŠ å…¥ã€Œå·¥åœ°ã€çš„ç©ºä½</span></div>
      </div>
      <div class="card span4">
        <h2>ğŸ’ å­—å¡ŠèƒŒåŒ…ï¼ˆé»é¸ä»¥æ”¾ç½®åˆ°å·¥åœ°ï¼‰</h2>
        <div id="inventory" class="inv" aria-label="èƒŒåŒ…å­—å¡Š"></div>
        <div class="hint">æç¤ºï¼šé»ä¸€ä¸‹é¸å–ï¼Œå†é»å·¥åœ°çš„ç©ºæ ¼æ”¾ç½®ï¼›å†æ¬¡é»é¸å–å¯å–æ¶ˆã€‚</div>
      </div>
    </div>
  </section>  <!-- å·¥åœ° -->  <section class="section" id="sec-build">
    <div class="cards">
      <div class="card span6">
        <h2>ğŸ—ï¸ æˆèªæ‹¼ç Œå°</h2>
        <div class="row">
          <div class="slots" id="slots"></div>
          <button class="btn" id="clearSlots">æ¸…ç©º</button>
        </div>
        <div class="row" style="margin-top:8px">
          <label class="tag">æ–¹å‘</label>
          <select id="orientation" class="btn">
            <option value="h">æ©«å‘</option>
            <option value="v">å‘ä¸Šå †é«˜</option>
          </select>
          <button class="btn primary" id="checkBtn">æª¢æŸ¥ä¸¦å»ºæ¨“</button>
        </div>
        <p class="hint">æ”¾å…¥å››å€‹å­—çµ„æˆæˆèªï¼›ä½¿ç”¨ <span class="kbd">ï¼Ÿ</span> è¬ç”¨å­—å¯ä»£æ›¿ä»»æ„ä¸€å­—ï¼ˆç¨€æœ‰ï¼‰ã€‚</p>
        <div class="divider"></div>
        <div id="buildMsg" class="hint"></div>
      </div>
      <div class="card span6">
        <h2>ğŸ¢ æˆ‘çš„å°æ¨“ï¼ˆå·²å»ºæˆçš„æˆèªï¼‰</h2>
        <div id="wall" class="wall" aria-live="polite"></div>
        <p class="hint">æ¯æˆåŠŸå»ºæˆä¸€æ¢æˆèªï¼š+5 ä»£å¹£ï¼›æ¯å®Œæˆä¸€å±¤ï¼ˆ4æ¢ï¼‰å¯é¡å¤– +20 ä»£å¹£ã€‚</p>
      </div>
    </div>
  </section>  <!-- å¸‚é›† -->  <section class="section" id="sec-market">
    <div class="cards">
      <div class="card span8">
        <h2>ğŸ›’ ç³»çµ±å•†åº—</h2>
        <div id="shop" class="shop"></div>
        <div class="row">
          <button class="btn" id="refreshShop">åˆ·æ–°å•†å“</button>
          <span class="hint">ç¨€æœ‰å­—è¼ƒè²´ï¼›æ¯æ—¥ç°½åˆ°å¯å¾—é¡å¤–ä»£å¹£ã€‚</span>
        </div>
      </div>
      <div class="card span4">
        <h2>ğŸ’± å‡ºå”®å¤šé¤˜å­—å¡Š</h2>
        <p class="hint">åœ¨èƒŒåŒ…ä¸­é»é¸è¦å‡ºå”®çš„å­—å¡Šï¼Œç„¶å¾ŒæŒ‰ã€Œå‡ºå”®ã€ã€‚</p>
        <div class="row">
          <button class="btn warn" id="sellBtn" disabled>å‡ºå”®æ‰€é¸å­—å¡Š</button>
          <span id="sellInfo" class="hint"></span>
        </div>
      </div>
    </div>
  </section>  <!-- æˆèªåº« -->  <section class="section" id="sec-dict">
    <div class="card">
      <h2>ğŸ“š èª²å…§æˆèªåº«ï¼ˆéƒ¨åˆ†ç¤ºä¾‹ï¼Œå¯è‡ªè¨‚ï¼‰</h2>
      <div id="idiomList" class="grid"></div>
    </div>
  </section>  <!-- æ•™å¸«/èªªæ˜ -->  <section class="section" id="sec-help">
    <div class="cards">
      <div class="card span8">
        <h2>ğŸ‘©ğŸ»â€ğŸ« æ•™å¸«è¨­å®šï¼ˆå¯é¸ï¼‰</h2>
        <p class="hint">åœ¨ä¸‹æ–¹è¼¸å…¥è‡ªè¨‚çš„å››å­—æˆèªï¼ˆæ¯è¡Œä¸€æ¢ï¼‰ï¼Œå†æŒ‰ã€ŒåŒ¯å…¥æˆèªæ¸…å–®ã€ã€‚
        ç³»çµ±æœƒè‡ªå‹•å¾æ¸…å–®ç”ŸæˆæŒ–ç¤¦å­—åº«èˆ‡æ ¡å°è¦å‰‡ã€‚</p>
        <textarea id="customIdioms" rows="8" style="width:100%;background:#0b1222;color:#e5e7eb;border:1px solid rgba(255,255,255,.18);border-radius:12px;padding:10px" placeholder="ä¾‹ï¼š\né¢¨é›¨åŒèˆŸ\nç•«é¾é»ç›\nåˆ»èˆŸæ±‚åŠ"></textarea>
        <div class="row" style="margin-top:8px">
          <button class="btn brand" id="importIdiomsBtn">åŒ¯å…¥æˆèªæ¸…å–®</button>
          <span class="hint">ï¼ˆåŒ¯å…¥å¾Œæœƒè¦†è“‹ç•¶å‰æˆèªåº«ï¼›å»ºè­°å…ˆç”¨ã€ŒåŒ¯å‡ºå­˜æª”ã€å‚™ä»½ï¼‰</span>
        </div>
      </div>
      <div class="card span4">
        <h2>â„¹ï¸ ä½¿ç”¨èªªæ˜</h2>
        <ul>
          <li>æ¯å¤©æŒ‰ã€Œç°½åˆ°ã€é ˜å–ä»£å¹£ï¼›é€£çºŒç°½åˆ°æœƒæœ‰é¡å¤–çå‹µã€‚</li>
          <li>åˆ°ã€Œç¤¦å ´ã€æŒ–å­—å¡Šï¼Œæˆ–åˆ°ã€Œå¸‚é›†ã€ç”¨ä»£å¹£è³¼è²·éœ€è¦çš„å­—ã€‚</li>
          <li>åœ¨ã€Œå·¥åœ°ã€æ”¾å…¥å››å€‹å­—ï¼Œçµ„æˆæˆèªå³å¯å»ºæ¨“ä¸¦ç²å¾—ä»£å¹£ã€‚</li>
          <li>èƒŒåŒ…å­—å¡Šå¯é»é¸â†’æ”¾å…¥ç©ºä½ï¼›å†æ¬¡é»é¸å¯å–æ¶ˆã€‚</li>
          <li>é¸ä¸­èƒŒåŒ…å­—å¡Šå¾Œï¼Œåœ¨å¸‚é›†å¯æŒ‰ã€Œå‡ºå”®ã€æ›å–ä»£å¹£ã€‚</li>
          <li>æ‰€æœ‰è³‡æ–™ä¿å­˜åœ¨æœ¬æ©Ÿç€è¦½å™¨ï¼ˆlocalStorageï¼‰ï¼Œå¯ç”¨ã€ŒåŒ¯å‡º/åŒ¯å…¥ã€æ¬å®¶ã€‚</li>
        </ul>
        <p class="hint">æœ¬ MVP æ¡ã€Œé›¢ç·šå–®æ©Ÿã€è¨­è¨ˆï¼›å¤šäººè¯æ©Ÿèˆ‡åŒå„•äº¤æ˜“å¯æ—¥å¾Œæ“´å±•ã€‚</p>
      </div>
    </div>
  </section>
</div><div id="toast" class="toast" style="display:none"></div><script>
// ====== è³‡æ–™ï¼šé è¨­æˆèªï¼ˆå¯è¢«å¾ŒçºŒè‡ªè¨‚è¦†è“‹ï¼‰ ======
const DEFAULT_IDIOMS = [
  "é¢¨é›¨åŒèˆŸ","åŒèˆŸå…±æ¿Ÿ","ç•«è›‡æ·»è¶³","ç•«é¾é»ç›","åˆ»èˆŸæ±‚åŠ","äº¡ç¾Šè£œç‰¢","å®ˆæ ªå¾…å…”","å°ç‰›å½ˆç´","ç›²äººæ‘¸è±¡","æ©è€³ç›œéˆ´",
  "ç‹å‡è™å¨","ç­é–€å¼„æ–§","è™é ­è›‡å°¾","æ¯å¼“è›‡å½±","æ»„æµ·ä¸€ç²Ÿ","æ»„æµ·æ¡‘ç”°","ä¹ç‰›ä¸€æ¯›","å››é¢æ¥šæ­Œ","æ„šå…¬ç§»å±±","ç²¾è¡›å¡«æµ·",
  "å›«åœ‡åæ£—","èƒ¸æœ‰æˆç«¹","æŒ‡é¹¿ç‚ºé¦¬","ä¸‰å¿ƒå…©æ„","é›ªä¸­é€ç‚­","éŒ¦ä¸Šæ·»èŠ±","æœ›æ¢…æ­¢æ¸´","ç•«åœ°ç‚ºç‰¢","ç ´é‡œæ²‰èˆŸ","èƒŒæ°´ä¸€æˆ°",
  "å¦‚é­šå¾—æ°´","å”‡äº¡é½’å¯’","è‡ªç›¸çŸ›ç›¾","èé›èµ·èˆ","è‰æœ¨çš†å…µ","å®ˆå£å¦‚ç“¶","æ»¾ç“œçˆ›ç†Ÿ","æ‰‹ä¸é‡‹å·","åšå¤é€šä»Š","ç•°æ›²åŒå·¥",
  "ä¸€ç®­é›™é›•","ç‹¼ç‹½ç‚ºå¥¸","ç„¡åœ°è‡ªå®¹","åè½å­«å±±","å«‰è³¢å¦’èƒ½","æ¨å·±ç‚ºäºº","é“è½å¡—èªª","é¢¨é¦¬ç‰›ä¸ç›¸åŠ","å±…å®‰æ€å±","å®‰å±…æ¨‚æ¥­",
  "å®‰ç„¶ç„¡æ™","ç©å°‘æˆå¤š","æºé æµé•·","å¾ªåºæ¼¸é€²","æ‹¾é‡‘ä¸æ˜§","å¾—éä¸”é","åŠé€”è€Œå»¢","å±¢è¦‹ä¸é®®","äººå±±äººæµ·","è¿«ä¸åŠå¾…",
  "å¿—åŒé“åˆ","å¤©é¦¬è¡Œç©º","æ»”æ»”ä¸çµ•","å£è‹¥æ‡¸æ²³","ç›®çªå£å‘†","ç¥æ©Ÿå¦™ç®—","ç•«é¤…å……é£¢","ç ´é¡é‡åœ“","é’å‡ºæ–¼è—","ä¸‰é¡§èŒ…å»¬",
  "è‰èˆ¹å€Ÿç®­","ä½œè³Šå¿ƒè™›","åæ‹¿ä¹ç©©","ä¸€é³´é©šäºº","æœä¸‰æš®å››","ç„¡å‹•æ–¼è¡·","æ¨é™³å‡ºæ–°","é ‘çŸ³é»é ­","é–‹é–€è¦‹å±±","æŒ‡æ—¥å¯å¾…",
  "ä¸å¯æ•‘è—¥","åŠ›ä¸å¾å¿ƒ","ç†ç›´æ°£å£¯","ä¸€æ¸…äºŒæ¥š","äº•äº•æœ‰æ¢","å¿ƒçŒ¿æ„é¦¬","è¦‹ç¾©å‹‡ç‚º","ä»¥èº«ä½œå‰‡","æ˜¥é¢¨åŒ–é›¨","é»˜ä¸ä½œè²",
  "è‹¦å£å©†å¿ƒ","æ˜çŸ¥æ•…çŠ¯","ä¸å¯æ€è­°","ç„¡å¯å¥ˆä½•","å¾ªè¦è¹ˆçŸ©","éš¨æ©Ÿæ‡‰è®Š"
];

const DEFAULT_EXPLAINS = {
  "é¢¨é›¨åŒèˆŸ":"åœ¨å›°é›£ä¸­åŒå¿ƒå”åŠ›ï¼Œå…±åº¦é›£é—œã€‚",
  "ç•«é¾é»ç›":"åœ¨é—œéµè™•åŠ ä¸Šä¸€ç­†ï¼Œä½¿å…§å®¹æ›´å‚³ç¥ã€‚",
  "åˆ»èˆŸæ±‚åŠ":"æ‹˜æ³¥æˆæ³•ï¼Œä¸çŸ¥è®Šé€šã€‚",
  "äº¡ç¾Šè£œç‰¢":"å‡ºäº†å·®éŒ¯å¾Œæƒ³è¾¦æ³•è£œæ•‘ï¼Œä»å¯é¿å…æå¤±æ“´å¤§ã€‚",
  "å®ˆæ ªå¾…å…”":"ä¸æ€é€²å–ï¼Œåç­‰åƒ¥å€–ã€‚",
  "å°ç‰›å½ˆç´":"èˆ‡å°æ–¹ä¸æ‡‚çš„äººèªªæ·±å¥§çš„è©±ï¼Œç™½è²»å”‡èˆŒã€‚",
  "ç›²äººæ‘¸è±¡":"ä»¥åæ¦‚å…¨ï¼Œèªè­˜ç‰‡é¢ã€‚",
  "æ©è€³ç›œéˆ´":"è‡ªæ¬ºæ¬ºäººã€‚",
  "ç­é–€å¼„æ–§":"åœ¨è¡Œå®¶é¢å‰è³£å¼„æœ¬é ˜ã€‚",
  "è™é ­è›‡å°¾":"åšäº‹æœ‰å§‹ç„¡çµ‚ã€‚",
  "æ¯å¼“è›‡å½±":"ç–‘ç¥ç–‘é¬¼ï¼Œé©šæ…Œå¤±æªã€‚",
  "æ»„æµ·ä¸€ç²Ÿ":"åœ¨å·¨å¤§çš„äº‹ç‰©ä¸­æ¥µå…¶å¾®å°ã€‚",
  "æ„šå…¬ç§»å±±":"å …æŒä¸æ‡ˆå°±èƒ½å…‹æœå›°é›£ã€‚",
  "èƒ¸æœ‰æˆç«¹":"åšäº‹ä¹‹å‰å·²æœ‰å®Œæ•´æ§‹æ€ã€‚",
  "æŒ‡é¹¿ç‚ºé¦¬":"é¡›å€’æ˜¯éã€‚",
  "é›ªä¸­é€ç‚­":"åœ¨å›°é›£æ™‚çµ¦äºˆåŠæ™‚å¹«åŠ©ã€‚",
  "éŒ¦ä¸Šæ·»èŠ±":"ä½¿ç¾å¥½çš„äº‹ç‰©æ›´åŠ ç¾å¥½ã€‚",
  "æœ›æ¢…æ­¢æ¸´":"ç”¨ç©ºæƒ³ä¾†å®‰æ…°è‡ªå·±ã€‚",
  "ç ´é‡œæ²‰èˆŸ":"ä¸‹å®šæ±ºå¿ƒï¼Œç¾©ç„¡åé¡§ã€‚",
  "èƒŒæ°´ä¸€æˆ°":"è™•æ–¼çµ•å¢ƒæ™‚æ‹¼æ­»ä¸€æã€‚",
  "å¦‚é­šå¾—æ°´":"æ‰¾åˆ°é©åˆè‡ªå·±çš„ç’°å¢ƒæˆ–å¤¥ä¼´ã€‚",
  "å”‡äº¡é½’å¯’":"é—œä¿‚å¯†åˆ‡ï¼Œæ¦®è¾±èˆ‡å…±ã€‚",
  "è‡ªç›¸çŸ›ç›¾":"è¨€è¡Œå‰å¾Œä¸ä¸€è‡´ã€‚",
  "èé›èµ·èˆ":"ç™¼å¥®åŠªåŠ›ä¸æ€ æƒ°ã€‚",
  "è‰æœ¨çš†å…µ":"éåº¦é©šæã€‚",
  "æ‰‹ä¸é‡‹å·":"å‹¤å¥®å¥½å­¸ï¼Œå¸¸è®€ä¸è¼Ÿã€‚",
  "ä¸€ç®­é›™é›•":"ä¸€èˆ‰å…©å¾—ã€‚",
  "å®‰å±…æ¨‚æ¥­":"ç”Ÿæ´»å®‰å®šï¼Œå·¥ä½œæ„‰å¿«ã€‚",
  "ç©å°‘æˆå¤š":"é‡è®Šå¼•èµ·è³ªè®Šï¼Œæ—¥ç©æœˆç´¯ã€‚",
  "å¾ªåºæ¼¸é€²":"æŒ‰æ­¥å°±ç­åœ°å‰é€²ã€‚",
  "é’å‡ºæ–¼è—":"å¾Œè¼©å‹éå‰è¼©ã€‚",
  "è‰èˆ¹å€Ÿç®­":"å–„ç”¨æ™‚æ©Ÿèˆ‡è³‡æºã€‚",
  "ä½œè³Šå¿ƒè™›":"åšäº†å£äº‹è€Œå¿ƒè™›ã€‚",
  "åæ‹¿ä¹ç©©":"æŠŠæ¡æ¥µå¤§ã€‚",
  "é–‹é–€è¦‹å±±":"èªªè©±ç›´å…¥ä¸»é¡Œã€‚",
  "ä¸å¯æ•‘è—¥":"å£åˆ°ç„¡æ³•æŒ½æ•‘ã€‚",
  "äº•äº•æœ‰æ¢":"æ¢ç†åˆ†æ˜ã€‚",
  "è¦‹ç¾©å‹‡ç‚º":"è¦‹åˆ°æ­£ç¾©çš„äº‹å‹‡æ–¼å»åšã€‚",
  "æ˜¥é¢¨åŒ–é›¨":"è‰¯å¥½çš„æ•™è‚²æ„ŸåŒ–äººå¿ƒã€‚",
  "è‹¦å£å©†å¿ƒ":"å¥½è¨€ç›¸å‹¸ï¼Œèªé‡å¿ƒé•·ã€‚",
  "ä¸å¯æ€è­°":"é›£ä»¥æƒ³åƒã€è¶…ä¹å¸¸ç†ã€‚"
};

// ====== ç‹€æ…‹ç®¡ç† ======
const LS_KEY = "chengyu_mine_mvp_v1";
let state = {
  tokens: 0,
  inventory: [], // {id, char, type:'normal'|'wild'}
  wall: [],      // å·²å»ºæˆçš„æˆèªé™£åˆ—
  idioms: DEFAULT_IDIOMS.slice(),
  explains: {...DEFAULT_EXPLAINS},
  lastSignin: null,
  streak: 0,
  shop: [], // {char, price, rare}
};

function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); showToast("âœ… å·²ä¿å­˜"); render(); }
function hardSave(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
function load(){ const s = localStorage.getItem(LS_KEY); if(s){ try{ state = JSON.parse(s); }catch(e){} } }

// ====== å·¥å…·ï¼šå­—é »èˆ‡æŒ–ç¤¦ ======
function getCharFreqMap(){
  const map = new Map();
  for(const idiom of state.idioms){
    if(idiom.length!==4) continue;
    for(const ch of idiom){ map.set(ch, (map.get(ch)||0)+1); }
  }
  return map;
}
function charPoolFromIdioms(){
  const freq = getCharFreqMap();
  const pool = [];
  // ä¾é »ç‡åŠ æ¬Šï¼ˆæœ€å¤šæ”¾åˆ° 6 æ¬¡ï¼Œé¿å…éæ–¼é›†ä¸­ï¼‰
  for(const [ch, n] of freq){ const times = Math.min(6, Math.max(1, Math.round(n/1))); for(let i=0;i<times;i++) pool.push(ch); }
  // åŠ å…¥å°‘é‡å¹²æ“¾å­—
  const noise = "å¤©åœ°å±±å·æ±Ÿæµ·é¢¨é›¨é›·é›»æ—¥æœˆæ˜Ÿè¾°èŠ±è‰æœ¨çŸ³é‡‘éŠ€éŠ…éµè²“ç‹—é³¥é­šé›²éœ§å½±å…‰å¿ƒæ„æƒ…æ€è¨€èªè¡Œå‹•";
  for(const ch of noise){ if(Math.random()<0.15) pool.push(ch); }
  return pool.length? pool : ["æˆ","èª","å­¸","ç¿’"];
}
let CHAR_POOL = charPoolFromIdioms();

function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)] }
function newTile(char, type='normal'){ return { id: "t"+Math.random().toString(36).slice(2), char, type } }

function dig(){
  const char = randomFrom(CHAR_POOL);
  const tile = newTile(char);
  state.inventory.push(tile);
  let gain = 1 + Math.floor(Math.random()*3); // 1~3
  // å°æ¦‚ç‡å¯¶ç®±
  if(Math.random()<0.08){ gain += 5; showToast("ğŸ æŒ–åˆ°å¯¶ç®±ï¼+"+gain+" ä»£å¹£") }
  state.tokens += gain;
  hardSave();
  document.getElementById('lastTile').textContent = char;
  renderInventory();
  updateTop();
}

// ====== ç°½åˆ° ======
function todayStr(){ const d=new Date(); return d.getFullYear()+"-"+(d.getMonth()+1).toString().padStart(2,'0')+"-"+d.getDate().toString().padStart(2,'0'); }
function signIn(){
  const today=todayStr();
  if(state.lastSignin===today){ showToast("ğŸ“… ä»Šæ—¥å·²ç°½åˆ°") ; return; }
  // åˆ¤æ–·æ˜¯å¦é€£çºŒ
  const last = state.lastSignin? new Date(state.lastSignin):null;
  const now = new Date();
  let cont = false;
  if(last){ const diffDays = Math.floor((now - new Date(last.getFullYear(), last.getMonth(), last.getDate()))/86400000); cont = (diffDays===1); }
  state.streak = cont ? (state.streak+1) : 1;
  state.lastSignin = today;
  let gain = 5; // åŸºæœ¬ 5 ä»£å¹£
  if(state.streak%7===0){ // æ¯ 7 å¤©é€ç¨€æœ‰è¬ç”¨å­—
    state.inventory.push(newTile('ï¼Ÿ','wild'));
    showToast("ğŸ”¥ é€£ç°½ "+state.streak+" å¤©ï¼Œç²å¾—ç¨€æœ‰ã€ï¼Ÿã€è¬ç”¨å­—ï¼+"+gain+" ä»£å¹£");
  }else if(state.streak%3===0){
    // é€éš¨æ©Ÿå­—
    state.inventory.push(newTile(randomFrom(CHAR_POOL)));
    showToast("ğŸ‘ é€£ç°½ "+state.streak+" å¤©ï¼Œé¡å¤–é€éš¨æ©Ÿå­—å¡Šï¼+"+gain+" ä»£å¹£");
  }else{
    showToast("âœ… å·²ç°½åˆ° +"+gain+" ä»£å¹£");
  }
  state.tokens += gain;
  hardSave();
  updateTop(); renderInventory();
}

// ====== å·¥åœ°ï¼šæ‹¼ç Œèˆ‡å»ºæ¨“ ======
const slotsEl = document.getElementById('slots');
let slots = [null,null,null,null]; // å­˜ tile.id æˆ– null
function renderSlots(){
  slotsEl.innerHTML = '';
  for(let i=0;i<4;i++){
    const s = document.createElement('div');
    s.className = 'slot'+(slots[i]?' filled':'');
    s.dataset.index = i;
    s.textContent = slotChar(i) || '';
    s.addEventListener('click', ()=>{
      if(selectedTileId){ placeSelectedToSlot(i); }
      else if(slots[i]){ // é»æ“Šå·²æ”¾å…¥çš„å­— â†’ å–å›èƒŒåŒ…
        const tid = slots[i];
        const t = state.inventory.find(x=>x.id===tid);
        if(t){ slots[i]=null; renderSlots(); renderInventory(); }
      }
    });
    slotsEl.appendChild(s);
  }
}
function slotChar(i){ const tid=slots[i]; if(!tid) return ''; const t=state.inventory.find(x=>x.id===tid); return t? t.char : ''; }

let selectedTileId = null; // èƒŒåŒ…ä¸­è¢«é¸ä¸­çš„ tile.id
function selectTile(id){ if(selectedTileId===id) selectedTileId=null; else selectedTileId=id; renderInventory(); updateSellInfo(); }
function placeSelectedToSlot(i){ if(!selectedTileId) return; if(slots[i]) return; slots[i]=selectedTileId; selectedTileId=null; renderSlots(); renderInventory(); updateSellInfo(); }

function slotsToString(){ return slots.map((tid)=>{ const t = state.inventory.find(x=>x.id===tid); return t? t.char:''; }).join(''); }

function matchIdiomWithWildcards(str){
  // str é•·åº¦ 4ï¼Œå¯å«ã€ï¼Ÿã€è¬ç”¨å­—
  const pattern = new RegExp('^'+Array.from(str).map(ch=> ch==='ï¼Ÿ'? '.': ch).join('')+'$');
  const list = state.idioms.filter(i=>pattern.test(i));
  return list[0] || null;
}

function consumeTilesAfterBuild(){
  // å»ºæ¨“å¾Œï¼šæ¶ˆè€—å·²ç”¨çš„ 4 å€‹å­—å¡Šï¼ˆè¬ç”¨å­—ä¹Ÿæœƒæ¶ˆè€—ï¼‰
  const usedIds = new Set(slots.filter(Boolean));
  state.inventory = state.inventory.filter(t=>!usedIds.has(t.id));
  slots = [null,null,null,null];
}

function checkAndBuild(){
  const str = slotsToString();
  if(str.length!==4 || /\s/.test(str)) { showToast('è«‹æ”¾å…¥å››å€‹å­—'); return; }
  // ç²¾ç¢ºåŒ¹é… or è¬ç”¨åŒ¹é…
  let ok = state.idioms.includes(str);
  let finalIdiom = str;
  if(!ok && str.includes('ï¼Ÿ')){
    const matched = matchIdiomWithWildcards(str);
    if(matched){ ok=true; finalIdiom = matched; }
  }
  if(!ok){ showToast('âŒ é€™ä¸æ˜¯èª²å…§æˆèªï¼ˆæˆ–æ¬¡åºä¸å°ï¼‰'); return; }
  // æˆåŠŸï¼šåŠ å…¥åˆ°ç‰†
  state.wall.push({text:finalIdiom, ori: document.getElementById('orientation').value});
  state.tokens += 5;
  // æ¯å®Œæˆä¸€å±¤ï¼ˆ4 å€‹ï¼‰é¡å¤– +20
  if(state.wall.length % 4 === 0){ state.tokens += 20; showToast('ğŸ¢ å®Œæˆä¸€å±¤ï¼é¡å¤– +20 ä»£å¹£'); }
  // æ¶ˆè€—å­—å¡Š
  consumeTilesAfterBuild();
  hardSave();
  renderWall(); renderSlots(); renderInventory(); updateTop();
  const explain = state.explains[finalIdiom] || '';
  document.getElementById('buildMsg').innerHTML = `âœ… <b>${finalIdiom}</b> å»ºæˆï¼${explain? 'ï¼ˆ'+explain+'ï¼‰': ''}`;
}

function renderWall(){
  const wall = document.getElementById('wall');
  wall.innerHTML = '';
  for(const b of state.wall){ const d = document.createElement('div'); d.className='brick'; d.textContent=b.text; wall.appendChild(d); }
}

// ====== å¸‚é›†ï¼šç³»çµ±å•†åº—èˆ‡å‡ºå”® ======
function rarityOfChar(ch){ const f = getCharFreqMap(); const n=f.get(ch)||0; if(ch==='ï¼Ÿ') return 'rare'; return n<=1? 'rare' : (n<=3? 'uncommon':'common'); }
function priceOfChar(ch, action='buy'){
  const r = rarityOfChar(ch);
  const base = r==='rare'? 10 : r==='uncommon'? 6 : 3;
  return action==='sell'? Math.max(1, Math.floor(base/2)) : base;
}

function genShop(){
  const freq = getCharFreqMap();
  const allChars = [...freq.keys()];
  const items = [];
  for(let i=0;i<6;i++){
    const ch = randomFrom(allChars);
    items.push({char: ch, price: priceOfChar(ch,'buy'), rare: rarityOfChar(ch)==='rare'});
  }
  // å°æ©Ÿç‡ä¸Šæ¶è¬ç”¨å­—
  if(Math.random()<0.2){ items[ Math.floor(Math.random()*items.length) ] = {char:'ï¼Ÿ', price: 18, rare:true}; }
  state.shop = items;
}

function renderShop(){
  const shop = document.getElementById('shop'); shop.innerHTML = '';
  for(const it of state.shop){
    const c = document.createElement('div'); c.className='shopItem';
    const t = document.createElement('div'); t.className='tile'+(it.char==='ï¼Ÿ'? ' wild':''); t.textContent=it.char; c.appendChild(t);
    const p = document.createElement('div'); p.innerHTML = `åƒ¹æ ¼ï¼š<span class="token">ğŸ’° ${it.price}</span>`; c.appendChild(p);
    const r = document.createElement('div'); r.className='hint'; r.textContent = it.char==='ï¼Ÿ' ? 'ç¨€æœ‰ï¼šè¬ç”¨å­—' : (it.rare? 'ç¨€æœ‰å­—':'å¸¸è¦‹å­—'); c.appendChild(r);
    const b = document.createElement('button'); b.className='btn'; b.textContent='è³¼è²·'; b.addEventListener('click', ()=>buyFromShop(it)); c.appendChild(b);
    shop.appendChild(c);
  }
}
function buyFromShop(it){
  if(state.tokens < it.price){ showToast('ä»£å¹£ä¸è¶³'); return; }
  state.tokens -= it.price;
  state.inventory.push(newTile(it.char, it.char==='ï¼Ÿ'?'wild':'normal'));
  hardSave();
  updateTop(); renderInventory(); showToast('ğŸ›’ æˆåŠŸè³¼è²·ï¼š'+it.char);
}

function updateSellInfo(){
  const info = document.getElementById('sellInfo');
  const btn = document.getElementById('sellBtn');
  if(!selectedTileId){ info.textContent=''; btn.disabled=true; return; }
  const t = state.inventory.find(x=>x.id===selectedTileId);
  if(!t){ info.textContent=''; btn.disabled=true; return; }
  const price = priceOfChar(t.char,'sell');
  info.textContent = `å¯è³£å‡º ${t.char} å¾— ${price} ä»£å¹£`;
  btn.disabled=false;
}
function sellSelected(){
  if(!selectedTileId) return;
  const idx = state.inventory.findIndex(x=>x.id===selectedTileId);
  if(idx===-1) return;
  const t = state.inventory[idx];
  const price = priceOfChar(t.char,'sell');
  state.tokens += price;
  state.inventory.splice(idx,1);
  selectedTileId=null;
  hardSave(); updateTop(); renderInventory(); updateSellInfo(); showToast('ğŸ’± å·²å‡ºå”®ï¼š'+t.char);
}

// ====== æˆèªåº«é¡¯ç¤º ======
function renderIdiomList(){
  const wrap = document.getElementById('idiomList'); wrap.innerHTML='';
  const ul = document.createElement('div');
  ul.style.display='grid'; ul.style.gridTemplateColumns='repeat(auto-fill,minmax(180px,1fr))'; ul.style.gap='8px';
  for(const i of state.idioms){
    const chip = document.createElement('div'); chip.className='pill'; chip.style.justifyContent='space-between'; chip.style.gap='6px';
    const span = document.createElement('span'); span.textContent = i; chip.appendChild(span);
    const hint = document.createElement('span'); hint.className='hint'; hint.textContent = state.explains[i]||''; chip.appendChild(hint);
    ul.appendChild(chip);
  }
  wrap.appendChild(ul);
}

// ====== èƒŒåŒ…æ¸²æŸ“ ======
function renderInventory(){
  const inv = document.getElementById('inventory'); inv.innerHTML='';
  for(const t of state.inventory){
    const d = document.createElement('div'); d.className='tile'+(t.type==='wild'? ' wild':''); d.textContent=t.char; d.dataset.id=t.id; if(selectedTileId===t.id) d.classList.add('sel');
    d.addEventListener('click', ()=>selectTile(t.id));
    inv.appendChild(d);
  }
}

// ====== UI è¼”åŠ© ======
function updateTop(){
  document.getElementById('tokenCount').textContent = state.tokens;
  document.getElementById('streak').textContent = state.streak || 0;
  document.getElementById('signinBtn').disabled = (state.lastSignin===todayStr());
}
function showToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; clearTimeout(showToast._t); showToast._t=setTimeout(()=>{t.style.display='none'}, 1500); }

// ====== å°å…¥/å°å‡º/é‡ç½® ======
function exportSave(){ const blob = new Blob([JSON.stringify(state,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='chengyu_mine_save.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url), 1000); }
function importSave(){
  const inp = document.createElement('input'); inp.type='file'; inp.accept='.json,application/json';
  inp.onchange = (e)=>{ const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ const obj=JSON.parse(r.result); state=obj; CHAR_POOL = charPoolFromIdioms(); hardSave(); boot(); showToast('âœ… åŒ¯å…¥å®Œæˆ'); }catch(err){ showToast('âŒ åŒ¯å…¥å¤±æ•—ï¼šæ ¼å¼éŒ¯èª¤'); } }; r.readAsText(f); };
  inp.click();
}
function resetAll(){ if(!confirm('ç¢ºå®šé‡ç½®ï¼Ÿæ‰€æœ‰é€²åº¦å°‡åˆªé™¤ï¼ˆä¸å¯å¾©åŸï¼‰')) return; localStorage.removeItem(LS_KEY); location.reload(); }

// ====== è‡ªè¨‚æˆèªæ¸…å–® ======
function importIdiomsFromText(){
  const tx = document.getElementById('customIdioms').value.trim(); if(!tx){ showToast('è«‹è¼¸å…¥æˆèªï¼ˆæ¯è¡Œä¸€æ¢ï¼‰'); return; }
  const arr = tx.split(/\n+/).map(s=>s.trim()).filter(Boolean).filter(s=>s.length===4);
  if(!arr.length){ showToast('æœªåµæ¸¬åˆ°å››å­—æˆèª'); return; }
  state.idioms = Array.from(new Set(arr));
  CHAR_POOL = charPoolFromIdioms();
  hardSave(); renderIdiomList(); showToast('âœ… å·²åŒ¯å…¥ '+state.idioms.length+' æ¢æˆèª');
}

// ====== å•Ÿå‹• ======
function boot(){
  load();
  // é˜²å‘†ï¼šç¢ºä¿ç‹€æ…‹æ¬„ä½å­˜åœ¨
  if(!Array.isArray(state.inventory)) state.inventory=[];
  if(!Array.isArray(state.wall)) state.wall=[];
  if(!Array.isArray(state.shop)) state.shop=[];
  if(!Array.isArray(state.idioms) || state.idioms.length===0){
    state.idioms = DEFAULT_IDIOMS.slice();
    state.explains = {...DEFAULT_EXPLAINS};
  }

  // å»ºç«‹å­—åº«
  CHAR_POOL = charPoolFromIdioms();

  // åˆå§‹æ¸²æŸ“
  renderSlots();
  renderInventory();
  renderWall();
  renderIdiomList();
  genShop();
  renderShop();
  updateTop();

  // ç¶å®šäº‹ä»¶
  document.getElementById('digBtn').addEventListener('click', dig);
  document.getElementById('signinBtn').addEventListener('click', signIn);
  document.getElementById('checkBtn').addEventListener('click', checkAndBuild);
  document.getElementById('clearSlots').addEventListener('click', ()=>{ slots=[null,null,null,null]; renderSlots(); });
  document.getElementById('refreshShop').addEventListener('click', ()=>{ genShop(); renderShop(); hardSave(); });
  document.getElementById('sellBtn').addEventListener('click', sellSelected);
  document.getElementById('saveBtn').addEventListener('click', save);
  document.getElementById('exportBtn').addEventListener('click', exportSave);
  document.getElementById('importBtn').addEventListener('click', importSave);
  document.getElementById('importIdiomsBtn').addEventListener('click', importIdiomsFromText);
  document.getElementById('resetBtn').addEventListener('click', resetAll);

  // åˆ†é åˆ‡æ›
  document.querySelectorAll('.tab').forEach(el=>{
    el.addEventListener('click', ()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      el.classList.add('active');
      const name = el.dataset.tab;
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.getElementById('sec-'+name).classList.add('active');
    });
  });

  // å¿«é€Ÿæ”¾ç½®ï¼šé»ã€Œæœ€æ–°æŒ–å‡ºã€â†’ è‡ªå‹•æ”¾åˆ°ä¸‹ä¸€å€‹ç©ºæ ¼
  const lastTileEl = document.getElementById('lastTile');
  lastTileEl.addEventListener('click', ()=>{
    if(!state.inventory.length) return;
    const last = state.inventory[state.inventory.length-1];
    selectedTileId = last.id;
    const idx = slots.findIndex(x=>!x);
    if(idx>=0){ placeSelectedToSlot(idx); }
  });
}

document.addEventListener('DOMContentLoaded', boot);
</script></body>
</html>
